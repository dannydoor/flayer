<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/music-items.css">
    <script type="text/javascript" src="./js/jwplayer.js"></script>
    <script>
      jwplayer.key = 'Bch7bd0cZt0adCRYHGveauTP1LaJlq1EMyrU/IxgfrGDc3gTqZxyPFEKKMI';
    </script>
    <script type="text/javascript" src="./js/slip.js"></script>
    <script type="text/javascript" src="./js/music-object.js"></script>
    <title>flayer</title>
  </head>
  <body>
    <div class="container">
      <div id='tab' class="">
        <div id="test-div"></div>
      </div>
      <div id="video"></div>
      <div class="control-panel">
        <button id="open-queue" data-tooltip="재생 중인 목록 보기"></button>
        <div class="control-container">
          <button id="repeat-button"></button>
          <div class="control-buttons">
            <button id="prev-button">
              <div class="tooltip">
                <div class="tooltip-header">
                  이전 곡
                </div>
                <div class="tooltip-desc">
                  <strong></strong>
                  <span></span>
                </div>
              </div>
            </button>
            <button id="play-or-pause" class="play"></button>
            <button id="next-button">
              <div class="tooltip">
                <div class="tooltip-header">
                  다음 곡
                </div>
                <div class="tooltip-desc">
                  <strong></strong>
                  <span></span>
                </div>
              </div>
            </button>
          </div>
          <button id="shuffle-button"></button>
        </div>
      </div>
      <div class="play-volume-bars">
        <input type="range" id="play-bar" value="0">
        <div class="timers">
          <span id="current-time">00:00</span>
          <span id="remaining-time">- 05:02</span>
        </div>
        <div class="volume-bar-container">
          <div id="mute-button"></div>
          <input type="range" id="volume-bar" value="0">
          <div id="volume-button"></div>
        </div>
      </div>
      <div class="song-info-section">
        <div class="song-info-block">
          <div class="curr-song-info">
            <strong id="curr-song-title">DM</strong>
            <span id="curr-song-artist">fromis_9</span>
          </div>
          <button id="open-curr-playlist">
            <div class="tooltip">
              <div class="tooltip-header">
                재생 중인 플레이리스트
              </div>
              <div class="tooltip-desc">
                <strong></strong>
              </div>
            </div>
          </button>
          <button id="like-this-button"></button>
          <button id="meatball-button"></button>
        </div>
        <button id="fullscreen-button" data-tooltip="전체화면"></button>
      </div>
    </div>
    </ul>
    <script>
      document.querySelectorAll('input[type=range]').forEach(item => {
        item.oninput = function(e) {
        let value = e.target.value;
        e.target.style.background = 'linear-gradient(to right, var(--color-primary, #595ae2) 0%, var(--color-primary, #595ae2) '+this.value +'%, var(--color-base-3, #d9d9d9) ' + this.value + '%, var(--color-base-3, #d9d9d9) 100%)'
      };
      })
      
      let testObjArray = [
        {
          id: 'musicID',
          title: 'DM',
          artist: 'fromis_9',
          src: '',
          startTime: 0,
          endTime: 206,
          duration: 206,
          isLiked: true,
          isPlaying: true,
          isNew: false,
          playedTime: 1,
        },
        {
          id: 'musicID2',
          title: 'Feel Good (SECRET CODE)',
          artist: 'fromis_9',
          src: '',
          startTime: 0,
          endTime: 223,
          duration: 223,
          isLiked: true,
          isPlaying: false,
          isNew: false,
          playedTime: 1,
        },
        {
          id: 'musicID3',
          title: '우리의 길 (feat. 김관호, 김다영, 김명식, 김상우, 김형미, 김훈희, 민나래, 이찬미, 임성규, 조서연, 조아라, 조찬미 & 한설희)',
          artist: '염평안',
          src: '',
          startTime: 0,
          endTime: 306,
          duration: 306,
          isLiked: true,
          isPlaying: false,
          isNew: false,
          playedTime: 1,
        },
        {
          id: 'musicID4',
          title: '너를 따라 너에게',
          artist: 'fromis_9',
          src: '',
          startTime: 0,
          endTime: 213,
          duration: 213,
          isLiked: true,
          isPlaying: false,
          isNew: false,
          playedTime: 1,
        },
        {
          id: 'musicID5',
          title: "L'Amour, Les Baguettes, Paris",
          artist: 'Stella Jang',
          src: '',
          startTime: 0,
          endTime: 167,
          duration: 167,
          isLiked: true,
          isPlaying: false,
          isNew: false,
          playedTime: 1,
        },
      ];
      
      let itemType = ['library', 'playlist', 'queue', 'editing', 'selectable'];
      
      let context = 'fromis_9';
      
      for (let i=0; i<5; i++) {
        let obj = testObjArray[i];
        let type = itemType[i];
        
        let item = document.createElement('div', {is : `${type}-item`});
        item.setup(obj, context, i+1);
        window['test-div'].append(item);
      }
      
      function setupSlip(list) {
        list.addEventListener('slip:beforereorder', function(e){
            /* if (!e.target.classList.contains('queue') && !e.target.classList.contains('editing')) {
                e.preventDefault();
            } */
            if (e.target.classList.contains('library') || e.target.classList.contains('playlist') || e.target.classList.contains('selectable')) e.preventDefault();
        }, false);
        
        list.addEventListener('slip:beforeswipe', e => {
          e.preventDefault();
        }, false);
        
        list.addEventListener('slip:beforewait', e => {
          if (e.target.classList.contains('music-drag')) {
            e.preventDefault();
          }
        }, false);
        
        list.addEventListener('slip:reorder', e => {
          e.target.parentNode.insertBefore(e.target, e.detail.insertBefore);
          return false;
        }, false);
        
        let options = {
          ignoredElements: ['.library', '.playlist', '.selectable'],
        };
        
        return new Slip(list, options);
      }
      
      let testDiv = window['test-div'];
      setupSlip(testDiv);
      
    </script>
  </body>
</html>